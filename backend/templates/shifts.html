<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Scheduling</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Added v=2 for cache busting calendar contrast update -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme-dark.css') }}?v=2">
    <!-- shifts-split-css -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/shifts.css') }}?v=1">
</head>
<body>
<header>
  {% include 'partials/_nav.html' %}
</header>
<main>
  <div class="container">
    <section class="card section">
        <h1>Shift Scheduling</h1>
        <div class="rowx">
            <div class="seg">
              <button class="btn btn-primary" id="btnNewShift">New Shift</button>
              <button class="btn btn-secondary" id="btnNewTimeOff">Add Time Off</button>
              <button class="btn btn-secondary" id="btnSelectMode">Select shifts</button>
              <button class="btn btn-danger hidden" id="btnDeleteSelected">Delete selected (0)</button>
            </div>
            <form id="addShiftForm" action="{{ url_for('shifts') }}" method="post" onsubmit="return validateShiftForm()">
                <input type="hidden" id="employee_id_select" name="employee_id" required>
                <input type="hidden" id="shift_time_input" name="shift_time" required>
                <input type="hidden" id="end_time_input" name="end_time">
                <input type="hidden" id="repeat_until_input" name="repeat_until">
                <!-- selected_days and repeat_weekly will be injected dynamically -->
                <button class="btn btn-primary hidden" type="submit" id="addShiftBtn">Add Shift</button>
            </form>
        </div>
    </section>

  <section class="card calendar">
        <div class="cal-head">
            <div class="btn-group">
                <button class="btn btn-secondary" id="prevPeriod" aria-label="Previous">« Prev</button>
                <button class="btn btn-secondary" id="todayBtn" aria-label="Current">Today</button>
                <button class="btn btn-secondary" id="nextPeriod" aria-label="Next">Next »</button>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" id="viewMonth">Month</button>
                <button class="btn btn-secondary" id="viewWeek">Week</button>
            </div>
            <div class="month-label" id="periodLabel"></div>
        </div>
        <div class="legend" id="calendarLegend" aria-label="Employee color legend"></div>
        <div class="grid">
            <div class="dow">Mon</div><div class="dow">Tue</div><div class="dow">Wed</div><div class="dow">Thu</div><div class="dow">Fri</div><div class="dow">Sat</div><div class="dow">Sun</div>
        </div>
        <div class="cells" id="grid"></div>
    </section>

  {% include 'partials/_shift_menu.html' %}

  {% include 'partials/_wizard_create.html' %}

  {% include 'partials/_wizard_edit_series.html' %}

  {% include 'partials/_wizard_edit_day.html' %}

  {% include 'partials/_wizard_time_off.html' %}

  <div id="timeOffPopover" class="menu to-popover" role="dialog" aria-modal="false" aria-labelledby="toPopTitle">
    <h4 id="toPopTitle">Time Off</h4>
    <div class="rowx" id="toPopDetails"></div>
    <div class="rowx">
      <label>Start</label>
  <input type="date" id="toEditStart" class="input" aria-label="Edit start date">
      <label>End</label>
  <input type="date" id="toEditEnd" class="input" aria-label="Edit end date">
      <label>Reason</label>
  <input type="text" id="toEditReason" class="input" maxlength="120" aria-label="Edit reason" placeholder="Reason (optional)">
    </div>
    <div class="rowx">
      <button class="btn btn-primary" id="toSaveEdit">Save</button>
      <button class="btn btn-danger" id="toDelete">Delete</button>
      <button class="btn btn-secondary" id="toClosePop">Close</button>
    </div>
    <div class="muted" id="toEditMsg"></div>
  </div>
  </div>
</main>

<script id="shifts-data" type="application/json">{{ shifts | tojson }}</script>
<script id="employees-data" type="application/json">{{ employees | tojson }}</script>
<script src="{{ url_for('static', filename='js/theme.js') }}"></script>
<!-- shifts-split-js (Phase 2 multi-module) -->
<script>
window.CARE_API = {
  deleteShift: "{{ url_for('api_delete_shift') }}",
  deleteSeries: "{{ url_for('api_delete_series') }}",
  swapShift: "{{ url_for('api_swap_shift') }}",
  updateSeries: "{{ url_for('api_update_series') }}"
};
</script>
<script src="{{ url_for('static', filename='js/shifts.utils.js') }}?v=3"></script>
<script src="{{ url_for('static', filename='js/shifts.calendar.js') }}?v=2"></script>
<script src="{{ url_for('static', filename='js/shifts.wizard.js') }}?v=2"></script>
<script src="{{ url_for('static', filename='js/shifts.menu.js') }}?v=3"></script>
<script src="{{ url_for('static', filename='js/shifts.edit.js') }}?v=3"></script>
</body>
</html>