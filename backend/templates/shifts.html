<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Scheduling</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Added v=2 for cache busting calendar contrast update -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/theme-dark.css') }}?v=2">
    <!-- shifts-split-css -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/shifts.css') }}?v=1">
</head>
<body>
<header>
    <nav class="nav">
        <div class="left">
            <span class="logo">Care Calendar</span>
            <a href="{{ url_for('index') }}">Home</a>
            <a href="{{ url_for('employees') }}">Employees</a>
            <a href="{{ url_for('shifts') }}">Shifts</a>
            <a href="{{ url_for('attendance') }}">Attendance</a>
            <a href="{{ url_for('tasks') }}">Tasks</a>
            <a href="{{ url_for('performance') }}">Performance</a>
            <a href="{{ url_for('hours_report') }}">Hours</a>
        </div>
        <div class="right">
            <a href="{{ url_for('logout') }}">Logout</a>
        </div>
    </nav>
</header>
<main>
    <section class="card section">
        <h1>Shift Scheduling</h1>
        <div class="rowx">
            <div class="seg">
              <button class="btn btn-primary" id="btnNewShift">New Shift</button>
              <button class="btn btn-secondary" id="btnSelectMode">Select shifts</button>
              <button class="btn btn-danger hidden" id="btnDeleteSelected">Delete selected (0)</button>
            </div>
            <form id="addShiftForm" action="{{ url_for('shifts') }}" method="post" onsubmit="return validateShiftForm()">
                <input type="hidden" id="employee_id_select" name="employee_id" required>
                <input type="hidden" id="shift_time_input" name="shift_time" required>
                <input type="hidden" id="end_time_input" name="end_time">
                <input type="hidden" id="repeat_until_input" name="repeat_until">
                <!-- selected_days and repeat_weekly will be injected dynamically -->
                <button class="btn btn-primary hidden" type="submit" id="addShiftBtn">Add Shift</button>
            </form>
        </div>
    </section>

    <section class="card calendar">
        <div class="cal-head">
            <div class="btn-group">
                <button class="btn btn-secondary" id="prevPeriod" aria-label="Previous">« Prev</button>
                <button class="btn btn-secondary" id="todayBtn" aria-label="Current">Today</button>
                <button class="btn btn-secondary" id="nextPeriod" aria-label="Next">Next »</button>
            </div>
            <div class="btn-group">
                <button class="btn btn-secondary" id="viewMonth">Month</button>
                <button class="btn btn-secondary" id="viewWeek">Week</button>
            </div>
            <div class="month-label" id="periodLabel"></div>
        </div>
        <div class="legend" id="calendarLegend" aria-label="Employee color legend"></div>
        <div class="grid">
            <div class="dow">Mon</div><div class="dow">Tue</div><div class="dow">Wed</div><div class="dow">Thu</div><div class="dow">Fri</div><div class="dow">Sat</div><div class="dow">Sun</div>
        </div>
        <div class="cells" id="grid"></div>
    </section>

  <div class="menu" id="shiftMenu" role="dialog" aria-modal="true" aria-labelledby="menuTitle" tabindex="-1">
        <h4 id="menuTitle">Shift</h4>
    <div class="row"><button class="btn btn-danger" id="btnDeleteShift">Delete shift</button><button class="btn btn-secondary hidden" id="btnDeleteSeries">Delete series</button></div>
        <div class="row">
      <select id="swapSelect" class="select"><option value="">Swap to…</option></select>
      <button class="btn btn-primary" id="btnSwap">Swap</button>
        </div>
        <!-- Edit buttons for series and single day -->
        <div class="row is-hidden" id="editSeriesRow">
            <div class="fullw">
                <div class="mini-label">Edit Options</div>
                <div class="seg">
                    <button class="btn btn-primary" id="btnOpenEditSeries">Edit Series</button>
                    <button class="btn btn-secondary" id="btnOpenEditDay">Edit Day</button>
                </div>
            </div>
        </div>
        <!-- Coverage window hidden as per requirements -->
        <div class="row is-hidden" id="coverageWindowRow">
            <div class="fullw">
                <div class="mini-label">Coverage window</div>
                <div class="seg">
                    <!-- Replaced native time inputs with 15-min selects -->
                    <div class="time-selects" aria-label="Coverage start">
            <select id="covStartHour" aria-label="Start hour" class="select">
                        <option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option>
                      </select>
                      <span>:</span>
            <select id="covStartMin" aria-label="Start minutes" class="select">
                        <option value="00">00</option><option value="15">15</option><option value="30">30</option><option value="45">45</option>
                      </select>
                    </div>
                    <div class="time-selects" aria-label="Coverage end">
            <select id="covEndHour" aria-label="End hour" class="select">
                        <option value="00">00</option><option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option>
                      </select>
                      <span>:</span>
            <select id="covEndMin" aria-label="End minutes" class="select">
                        <option value="00">00</option><option value="15">15</option><option value="30">30</option><option value="45">45</option>
                      </select>
                    </div>
          <button class="btn btn-secondary" id="btnSaveCoverage">Save</button>
                </div>
            </div>
        </div>
        <div class="footer-links">
      <button class="btn btn-secondary" id="btnCloseMenu">Close</button>
        </div>
    </div>

    <!-- Wizard Modal -->
    <div class="overlay" id="wizardOverlay" role="dialog" aria-modal="true" aria-labelledby="wizTitle">
      <div class="modal" id="wizardModal">
        <div class="hd" id="wizTitle">Create Shift</div>
        <div class="bd">
          <div class="step" id="step1">
            <div class="rowx">
              <label>Employee</label>
              <div id="wizEmployeeList" class="seg"></div>
            </div>
          </div>
          <div class="step hidden" id="step2">
            <div class="rowx">
              <label for="wizStartDate">Start date & time</label>
              <div class="time-selects">
                <input type="date" id="wizStartDate" class="input">
                <select id="wizStartHour12" aria-label="Start hour" class="select">
                  <option value="">HH</option>
                  <option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09" selected>09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option>
                </select>
                <span>:</span>
                <select id="wizStartMin" aria-label="Start minutes" class="select">
                  <option value="">MM</option>
                  <option value="00" selected>00</option>
                  <option value="15">15</option>
                  <option value="30">30</option>
                  <option value="45">45</option>
                </select>
                <div class="seg ampm-seg" role="radiogroup" aria-label="Start AM/PM">
                  <button type="button" class="chip ampm-btn active" id="wizStartAM" aria-pressed="true" data-value="AM">AM</button>
                  <button type="button" class="chip ampm-btn" id="wizStartPM" aria-pressed="false" data-value="PM">PM</button>
                </div>
              </div>
              <!-- Inline Calendar Widget -->
              <div class="inline-calendar" id="wizCalendar" role="grid" aria-label="Date picker calendar">
                <div class="cal-header">
                  <button type="button" class="cal-nav" id="wizCalPrev" aria-label="Previous month">&lt;</button>
                  <div class="cal-month" id="wizCalMonth" aria-live="polite"></div>
                  <button type="button" class="cal-nav" id="wizCalNext" aria-label="Next month">&gt;</button>
                </div>
                <div class="cal-weekdays">
                  <div class="cal-weekday">S</div><div class="cal-weekday">M</div><div class="cal-weekday">T</div><div class="cal-weekday">W</div><div class="cal-weekday">T</div><div class="cal-weekday">F</div><div class="cal-weekday">S</div>
                </div>
                <div class="cal-days" id="wizCalDays"></div>
              </div>
            </div>
            <div class="rowx">
              <label for="wizEndHour">End time (optional)</label>
              <div class="time-selects">
                <select id="wizEndHour12" aria-label="End hour" class="select">
                  <option value="">HH</option>
                  <option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option>
                </select>
                <span>:</span>
                <select id="wizEndMin" aria-label="End minutes" class="select">
                  <option value="">MM</option>
                  <option value="00">00</option>
                  <option value="15">15</option>
                  <option value="30">30</option>
                  <option value="45">45</option>
                </select>
                <div class="seg ampm-seg" role="radiogroup" aria-label="End AM/PM">
                  <button type="button" class="chip ampm-btn active" id="wizEndAM" aria-pressed="true" data-value="AM">AM</button>
                  <button type="button" class="chip ampm-btn" id="wizEndPM" aria-pressed="false" data-value="PM">PM</button>
                </div>
              </div>
            </div>
            <!-- Moved repeat controls into this step to keep all scheduling on one screen -->
            <div class="rowx">
              <label>Repeat</label>
              <button type="button" class="toggle-chip" id="wizRepeatToggle" aria-pressed="false">Repeat weekly</button>
            </div>
            <div class="rowx hidden" id="wizDaysCtn">
              <label>Weekdays</label>
              <div class="seg" id="wizDays" role="group" aria-label="Select weekdays"></div>
            </div>
            <div class="rowx hidden" id="wizUntilCtn">
              <label>Repeat until (optional)</label>
              <input type="date" id="wizUntil" class="input">
              <div class="muted">Defaults to end of year if empty.</div>
            </div>
          </div>
          <!-- step3 becomes the Review step -->
          <div class="step hidden" id="step3">
            <div class="rowx">
              <strong>Review</strong>
              <div id="wizReview" class="muted"></div>
            </div>
          </div>
          <!-- step4 removed -->
        </div>
        <div class="ft">
          <button class="btn btn-secondary" id="wizCancel">Cancel</button>
          <button class="btn btn-secondary hidden" id="wizBack">Back</button>
          <button class="btn btn-primary" id="wizNext">Next</button>
        </div>
      </div>
    </div>

    <!-- Edit Series Wizard Modal -->
    <div class="overlay is-hidden" id="editSeriesOverlay" role="dialog" aria-modal="true" aria-labelledby="editTitle">
      <div class="modal" id="editSeriesModal">
        <div class="hd" id="editTitle">Edit Series</div>
        <div class="bd">
          <div class="step" id="eStep1">
            <div class="rowx">
              <label>Scope</label>
              <div class="muted">Changes apply to future occurrences in this series starting this week.</div>
            </div>
            <div class="rowx">
              <label for="eEmployee">Reassign caregiver (optional)</label>
              <select id="eEmployee" class="select"><option value="">Keep current</option></select>
            </div>
          </div>
          <div class="step hidden" id="eStep2">
            <div class="rowx">
              <label>Start time</label>
              <div class="time-selects">
                <select id="eStartHour12" aria-label="Start hour" class="select">
                  <option value="">HH</option>
                  <option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option>
                </select>
                <span>:</span>
                <select id="eStartMin" aria-label="Start minutes" class="select">
                  <option value="00">00</option><option value="15">15</option><option value="30">30</option><option value="45">45</option>
                </select>
                <div class="seg ampm-seg" role="radiogroup" aria-label="Start AM/PM">
                  <button type="button" class="chip ampm-btn active" id="eStartAM" aria-pressed="true" data-value="AM">AM</button>
                  <button type="button" class="chip ampm-btn" id="eStartPM" aria-pressed="false" data-value="PM">PM</button>
                </div>
              </div>
            </div>
            <div class="rowx">
              <label>End time (optional)</label>
              <div class="time-selects">
                <select id="eEndHour12" aria-label="End hour" class="select">
                  <option value="">HH</option>
                  <option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option>
                </select>
                <span>:</span>
                <select id="eEndMin" aria-label="End minutes" class="select">
                  <option value="">MM</option>
                  <option value="00">00</option><option value="15">15</option><option value="30">30</option><option value="45">45</option>
                </select>
                <div class="seg ampm-seg" role="radiogroup" aria-label="End AM/PM">
                  <button type="button" class="chip ampm-btn active" id="eEndAM" aria-pressed="true" data-value="AM">AM</button>
                  <button type="button" class="chip ampm-btn" id="eEndPM" aria-pressed="false" data-value="PM">PM</button>
                </div>
              </div>
            </div>
          </div>
          <div class="step hidden" id="eStep3">
            <div class="rowx">
              <label>Weekdays</label>
              <div class="seg" id="eDays"></div>
            </div>
          </div>
          <div class="step hidden" id="eStep4">
            <div class="rowx">
              <label>Repeat until (optional)</label>
              <input type="date" id="eUntil" class="mini-input">
              <div class="muted">Defaults to end of year if empty.</div>
            </div>
          </div>
          <div class="step hidden" id="eStep5">
            <div class="rowx">
              <strong>Review</strong>
              <div id="eReview" class="muted"></div>
            </div>
          </div>
        </div>
        <div class="ft">
          <button class="btn btn-secondary" id="eCancel">Cancel</button>
          <button class="btn btn-secondary hidden" id="eBack">Back</button>
          <button class="btn btn-primary" id="eNext">Next</button>
        </div>
      </div>
    </div>

    <!-- Edit Day Wizard Modal -->
    <div class="overlay is-hidden" id="editDayOverlay" role="dialog" aria-modal="true" aria-labelledby="editDayTitle">
      <div class="modal" id="editDayModal">
        <div class="hd" id="editDayTitle">Edit Day</div>
        <div class="bd">
          <div class="step" id="dStep1">
            <div class="rowx">
              <label>Scope</label>
              <div class="muted">Changes apply only to this specific day's shift. The rest of the series remains unchanged.</div>
            </div>
            <div class="rowx">
              <label for="dEmployee">Reassign caregiver (optional)</label>
              <select id="dEmployee" class="select"><option value="">Keep current</option></select>
            </div>
          </div>
          <div class="step hidden" id="dStep2">
            <div class="rowx">
              <label>Start time</label>
              <div class="time-selects">
                <select id="dStartHour12" aria-label="Start hour" class="select">
                  <option value="">HH</option>
                  <option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option>
                </select>
                <span>:</span>
                <select id="dStartMin" aria-label="Start minutes" class="select">
                  <option value="00">00</option><option value="15">15</option><option value="30">30</option><option value="45">45</option>
                </select>
                <div class="seg ampm-seg" role="radiogroup" aria-label="Start AM/PM">
                  <button type="button" class="chip ampm-btn active" id="dStartAM" aria-pressed="true" data-value="AM">AM</button>
                  <button type="button" class="chip ampm-btn" id="dStartPM" aria-pressed="false" data-value="PM">PM</button>
                </div>
              </div>
            </div>
            <div class="rowx">
              <label>End time (optional)</label>
              <div class="time-selects">
                <select id="dEndHour12" aria-label="End hour" class="select">
                  <option value="">HH</option>
                  <option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option><option value="06">06</option><option value="07">07</option><option value="08">08</option><option value="09">09</option><option value="10">10</option><option value="11">11</option><option value="12">12</option>
                </select>
                <span>:</span>
                <select id="dEndMin" aria-label="End minutes" class="select">
                  <option value="">MM</option>
                  <option value="00">00</option><option value="15">15</option><option value="30">30</option><option value="45">45</option>
                </select>
                <div class="seg ampm-seg" role="radiogroup" aria-label="End AM/PM">
                  <button type="button" class="chip ampm-btn active" id="dEndAM" aria-pressed="true" data-value="AM">AM</button>
                  <button type="button" class="chip ampm-btn" id="dEndPM" aria-pressed="false" data-value="PM">PM</button>
                </div>
              </div>
            </div>
          </div>
          <div class="step hidden" id="dStep3">
            <div class="rowx">
              <strong>Review</strong>
              <div id="dReview" class="muted"></div>
            </div>
          </div>
        </div>
        <div class="ft">
          <button class="btn btn-secondary" id="dCancel">Cancel</button>
          <button class="btn btn-secondary hidden" id="dBack">Back</button>
          <button class="btn btn-primary" id="dNext">Next</button>
        </div>
      </div>
    </div>
</main>

<script id="shifts-data" type="application/json">{{ shifts | tojson }}</script>
<script id="employees-data" type="application/json">{{ employees | tojson }}</script>
<script src="{{ url_for('static', filename='js/theme.js') }}"></script>
<!-- shifts-split-js -->
<script src="{{ url_for('static', filename='js/shifts.js') }}?v=1"></script>
</body>
</html>